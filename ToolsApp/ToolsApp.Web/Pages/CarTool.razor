@page "/car-tool"

@using ToolsApp.Components.CarTool

<ToolHeader HeaderText="Car Tool"></ToolHeader>

<CarTable Cars="@Cars" EditCarId="@editCarId"
          OnSaveCar="@SaveCar" OnCancelCar="@CancelCar"
          OnEditCar="@EditCar" OnDeleteCar="@DeleteCar" />

<CarForm ButtonText="Add Car" OnSubmitCar="@AddCar" />

@code {

  public List<ICar> Cars { get; set; } = new() {
    new Car() { Id = 1, Make="Ford", Model="Fusion Hybrid", Year=2020, Color="Blue", Price=45000 },
    new Car() { Id = 2, Make="Tesla", Model="S", Year=2022, Color="Red", Price=115000 },
  };

  private int editCarId { get; set; } = -1;

  public void EditCar(int carId)
  {
    editCarId = carId;
  }

  public void CancelCar()
  {
    editCarId = -1;
  }

  public void AddCar(INewCar newCar)
  {
    Cars.Add(new Car()
      {
        Id = Cars.Any() ? Cars.Max(c => c.Id) + 1 : 1,
        Make = newCar.Make,
        Model = newCar.Model,
        Year = newCar.Year,
        Color = newCar.Color,
        Price = newCar.Price,
      });
    editCarId = -1;
  }

  public void SaveCar(ICar car)
  {
    var carIndex = Cars.FindIndex(c => c.Id == car.Id);
    Cars[carIndex] = car;
    editCarId = -1;
  }

  public void DeleteCar(int carId)
  {
    Cars.Remove(Cars.Find(car => car.Id == carId));
    editCarId = -1;
  }
}
